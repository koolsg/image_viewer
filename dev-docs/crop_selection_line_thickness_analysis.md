# 크롭 선택 박스 선 두께 분석

## 개요
이 문서는 크롭 다이얼로그에서 `_HandleItem`과 선택 박스 테두리/그리드에 `ItemIgnoresTransformations`와 `cosmetic pen`을 사용하는 제안을 분석합니다. 줌 레벨에 따라 일정한 선 두께를 유지하는 데 초점을 맞추며, 픽셀 단위 정밀 크롭을 목표로 하지만, 현재 구현은 히트 테스트 기반 커서 결정으로 인해 UX 불일치를 초래할 위험이 있습니다.

## 현재 문제
- **선 두께가 줌에 따라 변함**: 테두리와 그리드가 이미지/씬 좌표에 따라 스케일링되어, 작은 이미지에서는 너무 두껍고 큰 이미지(예: 3600×5400)에서는 너무 얇아 보입니다.
- **사용자 요구사항**: 테두리는 씬 스케일에 묶이지 않고 화면에서 일정하게 보이도록(예: 2px).
- **히트 테스트 구조**: `SelectionRectItem.hit_test()`가 에지 근접성(수학적 거리)을 기반으로 리사이즈 커서를 결정하며, `_HandleItem`도 호버 시 커서를 바꾸지만, 실제 판정은 히트 테스트가 합니다. 이로 인해 시각적 단서와 실제 동작 간 불일치("거짓말")가 발생할 수 있습니다.

## 제안된 변경 사항 비판

### 1. _HandleItem에 ItemIgnoresTransformations 적용
**장점**:
- 줌 시 핸들이 화면에서 고정 크기로 유지되어 사용성이 향상됩니다.

**단점**:
- 기존 이중 좌표 관리(`_view_rect` vs `_parent_rect`)와 결합 시 좌표계가 복잡해집니다.
- 다중 뷰나 HiDPI 시나리오에서 입력 이벤트(마우스 좌표, 히트 영역) 불일치 위험이 있습니다.
- 드래그/리사이즈 디버깅이 어려워집니다.

**결론**: 핸들에는 적합하지만 기존 구조적 문제를 증폭시킬 수 있습니다.

### 2. 테두리/그리드에 Cosmetic Pen 적용
**장점**:
- 줌에 관계없이 선이 일정하게(예: 1px) 보이도록 하여 시각적 노이즈를 줄입니다.

**단점**:
- 큰 이미지에서 2px 요구사항을 충족하지 못합니다.
- `shape()`/`boundingRect()`가 시각적 두께와 일치하지 않아 히트 테스트 일관성을 깨뜨릴 수 있습니다.
- 에지 기반 히트 테스트 시스템에서 커서 변경 임계값이 씬 스케일에 남아 있어 UX 불일치가 발생합니다.

**결론**: 문제의 절반만 해결하고 새로운 정렬 문제를 유발합니다.

### 3. 전체 구조적 위험
- **히트 테스트 vs 시각 불일치**: Cosmetic 변경으로 커서가 사용자에게 "거짓말"할 수 있습니다.
- **조정 비용**: 픽셀 퍼펙트 렌더링, 그리드 LOD(세부 수준), 입력 임계값 튜닝을 위한 추가 로직 필요.
- **테스트 영향**: 수동 검증으로 에지 케이스를 놓칠 수 있음; 커서 동작 자동 테스트 필수.

## 추천 접근 방식
`ItemIgnoresTransformations`/`cosmetic pen`에만 의존하지 말고, `paint()`에서 화면 픽셀 기반 두께 계산을 구현하세요:

- **테두리**: 화면에서 항상 2px (계산: `pen_width_scene = 2 / view_scale`).
- **그리드**: 화면에서 1px, 선택적 알파/투명도.
- **히트 테스트 임계값**: 화면 픽셀 기준으로 정의 (예: `edge_margin_px = max(handle_radius_px, border_px * α)`).
- **장기적**: 리사이즈 책임을 `_HandleItem`으로 단일화하여 히트 테스트 불일치를 제거.

이 접근은 Cosmetic Pen의 단점을 피하면서 가독성을 유지하고 픽셀 정밀 목표에 맞습니다.

## 다음 단계
- `ui_crop_selection.py`에서 히트 테스트 구현 검토.
- `paint()` 메서드에서 화면 기반 펜 두께 프로토타이핑.
- 줌 레벨 커서 일관성 테스트 추가.